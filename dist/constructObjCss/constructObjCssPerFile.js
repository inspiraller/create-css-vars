'use strict';var __importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{'default':mod};};Object.defineProperty(exports,'__esModule',{value:true});exports.deepClone=void 0;const getSafeMarkers_1=__importDefault(require('../util/getSafeMarkers'));const clearCssComents_1=__importDefault(require('../util/clearCssComents'));const regCss_1=require('../util/regCss');const markEndCurly_1=__importDefault(require('../util/markEndCurly'));const execConstructObjCss_1=__importDefault(require('./execConstructObjCss'));const constructCombinedObjCss_1=__importDefault(require('./constructCombinedObjCss'));const constructAnyObjCss_1=__importDefault(require('./constructAnyObjCss'));const constructAnySingles_1=__importDefault(require('./constructAnySingles'));const iterateConstructMediaQObjCss_1=__importDefault(require('./iterateConstructMediaQObjCss'));const createTheme_1=__importDefault(require('./createTheme'));const isEmpty=obj=>Object.keys(obj).length===0;const replaceMediaQ=(str,m1,m2)=>{str=markEndCurly_1.default(str,m1,m2);str=str.replace(RegExp(`\\@media[^\\${m2}]*\\${m2}`,'g'),'');str=str.replace(RegExp(`\\${m2}`,'g'),'');return str;};function deepClone(obj){return JSON.parse(JSON.stringify(obj));}exports.deepClone=deepClone;const constructObjCssPerFile=(strReadFile,objCssAll,isMediaQ=false)=>{let str=` ${strReadFile}`;const {objM:{m1,m2}}=getSafeMarkers_1.default(str);str=clearCssComents_1.default(str,m1);const cloneSingle=objCssAll.single?deepClone(objCssAll.single):{};let single=execConstructObjCss_1.default({objCss:cloneSingle,str:str,reg:regCss_1.regMatchAnySingle,constructCssObj:constructAnySingles_1.default});if(!isMediaQ||!isEmpty(single)){objCssAll.single=single;}const strExcludeMediaQ=!isMediaQ?replaceMediaQ(str,m1,m2):str;const cloneCombined=objCssAll.combined?deepClone(objCssAll.combined):{};const combined=execConstructObjCss_1.default({objCss:cloneCombined,str:strExcludeMediaQ,reg:regCss_1.regCombined,constructCssObj:constructCombinedObjCss_1.default});if(!isMediaQ||!isEmpty(combined)){objCssAll.combined=combined;}const singleOrCloneSingle=isEmpty(objCssAll.single||{})&&cloneSingle||objCssAll.single;single=execConstructObjCss_1.default({objCss:singleOrCloneSingle,str:strExcludeMediaQ,reg:regCss_1.regSingle,constructCssObj:constructAnyObjCss_1.default});if(!isMediaQ||!isEmpty(single)){objCssAll.single=single;}const cloneChild=objCssAll.withchild?deepClone(objCssAll.withchild):{};const withchild=execConstructObjCss_1.default({objCss:cloneChild,str:strExcludeMediaQ,reg:regCss_1.regWithChild,constructCssObj:constructAnyObjCss_1.default});if(!isMediaQ||!isEmpty(withchild)){objCssAll.withchild=withchild;}const clonePseudo=objCssAll.pseudo?deepClone(objCssAll.pseudo):{};const pseudo=execConstructObjCss_1.default({objCss:clonePseudo,str:strExcludeMediaQ,reg:regCss_1.regPseudoOrAttr,constructCssObj:constructAnyObjCss_1.default});if(!isMediaQ||!isEmpty(pseudo)){objCssAll.pseudo=pseudo;}const objCssWithMediaQ=objCssAll;if(objCssWithMediaQ.mediaq){objCssWithMediaQ.mediaq=iterateConstructMediaQObjCss_1.default({objMediaQ:objCssWithMediaQ.mediaq,str,m1,m2});}const theme=!isMediaQ?createTheme_1.default(strReadFile):null;if(theme){objCssAll.theme=Object.assign(Object.assign({},objCssAll.theme),theme);}return objCssAll;};exports.default=constructObjCssPerFile;